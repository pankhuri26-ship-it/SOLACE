<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solace - PS 05: Offline Emergency Network</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --sage-green: #D1E8E2;
            --soft-teal: #4A7C77;
            --off-white: #F9FBFA;
            --medical-red: #E63946;
            --fire-orange: #F3722C;
            --rescue-blue: #4361EE;
            --misc-gray: #4A5568;
        }

        body {
            background-color: var(--off-white);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: #333;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(209, 232, 226, 0.6);
            box-shadow: 0 10px 40px -10px rgba(74, 124, 119, 0.15);
        }

        /* Long Press Interaction */
        .emergency-trigger {
            position: relative;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .emergency-trigger:active { transform: scale(0.95); }
        
        .progress-ring {
            position: absolute;
            inset: -8px;
            pointer-events: none;
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.1s linear;
        }

        /* Specific Button Colors */
        .btn-medical { background: var(--medical-red); color: white; }
        .btn-fire { background: var(--fire-orange); color: white; }
        .btn-rescue { background: var(--rescue-blue); color: white; }
        .btn-misc { background: var(--misc-gray); color: white; }

        .pulse-effect { animation: pulse-ring 1.5s cubic-bezier(0.24, 0, 0.38, 1) infinite; }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(0, 0, 0, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }

        .location-dot {
            width: 14px;
            height: 14px;
            background: #E63946;
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 15px rgba(230, 57, 70, 0.8);
            transition: all 1s ease-in-out;
            z-index: 10;
        }

        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #activeSosBar {
            background: #1a202c;
            color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }
        #activeSosBar.show { transform: translateY(0); }
        
        .helpline-card {
            background: linear-gradient(135deg, #4A7C77 0%, #365c58 100%);
            color: white;
        }

        /* Mesh Map Styling */
        .mesh-node { transition: all 0.5s ease; }
        .mesh-line { stroke: #4A7C77; stroke-dasharray: 5; animation: dash 3s linear infinite; opacity: 0.2; }
        @keyframes dash { to { stroke-dashoffset: -50; } }

        .progress-bar-container { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Active SOS Floating Bar -->
    <div id="activeSosBar" class="p-4 shadow-2xl flex justify-between items-center border-t border-white/10">
        <div class="flex items-center space-x-3">
            <div class="animate-pulse bg-red-500/20 p-2 rounded-lg text-red-500">
                <i class="fas fa-location-crosshairs"></i>
            </div>
            <div class="text-xs">
                <p class="font-bold text-red-400 uppercase tracking-tighter">Live Relay Active</p>
                <p class="opacity-80 font-mono text-[9px]" id="liveCoords">Lat: 28.6139, Lon: 77.2090</p>
            </div>
        </div>
        <button onclick="goToResponder()" class="bg-white text-slate-900 px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-wider">Dashboard</button>
    </div>

    <!-- Header -->
    <header class="p-6 flex justify-between items-center bg-white/80 border-b border-sage-green sticky top-0 z-50">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-[#4A7C77] rounded-xl flex items-center justify-center text-white shadow-lg">
                <i class="fas fa-feather-pointed text-lg"></i>
            </div>
            <div>
                <h1 class="text-xl font-black tracking-tight text-[#4A7C77]">SOLACE</h1>
                <span class="text-[9px] uppercase tracking-widest text-gray-400 font-bold">PS-05: Offline Mesh Network</span>
            </div>
        </div>
        
        <div class="flex items-center space-x-4">
            <div class="px-3 py-1.5 rounded-full bg-green-50 flex items-center border border-green-200">
                <span class="h-2 w-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                <span class="text-[10px] font-bold text-green-700 uppercase">Network: Ready</span>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 flex flex-col items-center">
        
        <!-- SECTION 1: MAIN SOS INTERFACE -->
        <div id="userSection" class="w-full max-w-4xl fade-in">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-black text-slate-800 mb-2">Emergency Assistance</h2>
                <p class="text-gray-500 text-sm">Hold a button for 2 seconds. The mesh will automatically find help.</p>
            </div>

            <!-- Emergency Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                <!-- Medical -->
                <div class="emergency-trigger btn-medical rounded-[2.5rem] p-8 flex flex-col items-center justify-center space-y-4 shadow-xl"
                     onmousedown="startPress(event, 'Medical')" ontouchstart="startPress(event, 'Medical')"
                     onmouseup="cancelPress()" ontouchend="cancelPress()">
                    <svg class="progress-ring" width="100%" height="100%" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" id="ring-Medical" stroke="white" stroke-opacity="0.3"></circle>
                    </svg>
                    <i class="fas fa-user-nurse text-5xl"></i>
                    <div class="text-center">
                        <h3 class="text-2xl font-black uppercase">Medical</h3>
                        <p class="text-white/70 text-[10px] font-bold tracking-widest">AMBULANCE / DOCTOR</p>
                    </div>
                </div>

                <!-- Fire -->
                <div class="emergency-trigger btn-fire rounded-[2.5rem] p-8 flex flex-col items-center justify-center space-y-4 shadow-xl"
                     onmousedown="startPress(event, 'Fire')" ontouchstart="startPress(event, 'Fire')"
                     onmouseup="cancelPress()" ontouchend="cancelPress()">
                    <svg class="progress-ring" width="100%" height="100%" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" id="ring-Fire" stroke="white" stroke-opacity="0.3"></circle>
                    </svg>
                    <i class="fas fa-fire-extinguisher text-5xl"></i>
                    <div class="text-center">
                        <h3 class="text-2xl font-black uppercase">Fire</h3>
                        <p class="text-white/70 text-[10px] font-bold tracking-widest">FIRE BRIGADE</p>
                    </div>
                </div>

                <!-- Rescue -->
                <div class="emergency-trigger btn-rescue rounded-[2.5rem] p-8 flex flex-col items-center justify-center space-y-4 shadow-xl"
                     onmousedown="startPress(event, 'Rescue')" ontouchstart="startPress(event, 'Rescue')"
                     onmouseup="cancelPress()" ontouchend="cancelPress()">
                    <svg class="progress-ring" width="100%" height="100%" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" id="ring-Rescue" stroke="white" stroke-opacity="0.3"></circle>
                    </svg>
                    <i class="fas fa-person-falling-burst text-5xl"></i>
                    <div class="text-center">
                        <h3 class="text-2xl font-black uppercase">Rescue</h3>
                        <p class="text-white/70 text-[10px] font-bold tracking-widest">DISASTER / SEARCH</p>
                    </div>
                </div>

                <!-- Misc -->
                <div class="emergency-trigger btn-misc rounded-[2.5rem] p-8 flex flex-col items-center justify-center space-y-4 shadow-xl"
                     onmousedown="startPress(event, 'Miscellaneous')" ontouchstart="startPress(event, 'Miscellaneous')"
                     onmouseup="cancelPress()" ontouchend="cancelPress()">
                    <svg class="progress-ring" width="100%" height="100%" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" id="ring-Miscellaneous" stroke="white" stroke-opacity="0.3"></circle>
                    </svg>
                    <i class="fas fa-handshake-angle text-5xl"></i>
                    <div class="text-center">
                        <h3 class="text-2xl font-black uppercase">Other Help</h3>
                        <p class="text-white/70 text-[10px] font-bold tracking-widest">GENERAL ASSISTANCE</p>
                    </div>
                </div>
            </div>

            <!-- Helpline Card -->
            <div class="helpline-card rounded-[2rem] p-8 flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 shadow-lg border-2 border-white/20">
                <div class="flex items-center space-x-5">
                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center text-3xl pulse-effect">
                        <i class="fas fa-phone-volume"></i>
                    </div>
                    <div>
                        <h4 class="text-sm font-bold opacity-80 uppercase tracking-widest">Special Solace Helpline</h4>
                        <p class="text-3xl font-black">+1 800 SOLACE (765 223)</p>
                    </div>
                </div>
                <a href="tel:1800765223" class="bg-white text-soft-teal px-8 py-4 rounded-2xl font-black uppercase tracking-tighter hover:scale-105 transition-transform">Call Now</a>
            </div>
        </div>

        <!-- SECTION 2: TRACKING & MESH DASHBOARD -->
        <div id="responderSection" class="w-full max-w-7xl hidden space-y-6 fade-in">
            <div class="flex justify-between items-center">
                <button onclick="goToUserSection()" class="bg-white px-4 py-2 rounded-xl text-xs font-bold text-gray-400 border border-gray-200">
                    <i class="fas fa-chevron-left mr-2"></i> EMERGENCY HOME
                </button>
                <div class="flex items-center space-x-3">
                    <span id="trustIndicator" class="text-[10px] font-black uppercase px-3 py-1 bg-yellow-100 text-yellow-700 rounded-lg">Verification: Pending</span>
                    <button onclick="location.reload()" class="bg-red-50 text-red-600 px-4 py-2 rounded-xl text-xs font-bold uppercase">Terminate SOS</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <!-- Left: Live Map Tracking -->
                <div class="lg:col-span-8 glass-card rounded-[2.5rem] p-6 relative overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-black text-slate-800 uppercase tracking-tight">Real-Time Location Relay</h3>
                        <div class="flex items-center space-x-2">
                            <span class="h-2 w-2 bg-red-500 rounded-full animate-ping"></span>
                            <span class="text-[10px] font-mono" id="coordDisplay">28.6139, 77.2090</span>
                        </div>
                    </div>

                    <div class="bg-slate-900 w-full h-[450px] rounded-[2rem] relative overflow-hidden shadow-2xl" id="mapArea">
                        <!-- Simulated Mesh Background -->
                        <svg class="absolute inset-0 w-full h-full opacity-40" id="meshSvg">
                            <!-- Static Mesh Lines -->
                            <line x1="10%" y1="20%" x2="40%" y2="50%" class="mesh-line" />
                            <line x1="40%" y1="50%" x2="70%" y2="30%" class="mesh-line" />
                            <line x1="70%" y1="30%" x2="90%" y2="80%" class="mesh-line" />
                            
                            <!-- Animated Path -->
                            <path id="routeLine" d="" fill="none" stroke="#E63946" stroke-width="2" stroke-dasharray="8" />
                        </svg>

                        <!-- User Marker -->
                        <div id="userMarker" class="location-dot"></div>

                        <!-- Hubs and Peers -->
                        <div class="absolute top-[20%] left-[10%] text-teal-400 opacity-60 flex flex-col items-center">
                            <i class="fas fa-tower-broadcast"></i>
                            <span class="text-[8px] font-bold mt-1">HUB ALPHA</span>
                        </div>
                        <div class="absolute bottom-[20%] right-[10%] text-teal-400 opacity-60 flex flex-col items-center">
                            <i class="fas fa-hospital"></i>
                            <span class="text-[8px] font-bold mt-1">DISPATCH</span>
                        </div>

                        <!-- Labels for judges -->
                        <div class="absolute bottom-4 left-4 flex space-x-4 bg-black/60 p-3 rounded-xl backdrop-blur-md">
                            <div class="flex items-center space-x-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><span class="text-[9px] text-white">Victim</span></div>
                            <div class="flex items-center space-x-2"><div class="w-3 h-3 bg-teal-500 rounded-full opacity-50"></div><span class="text-[9px] text-white">Mesh Node</span></div>
                        </div>
                    </div>
                </div>

                <!-- Right: Status & Tech Logs -->
                <div class="lg:col-span-4 space-y-6">
                    <div class="glass-card rounded-[2rem] p-6">
                        <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4">Consensus Status</h4>
                        <div class="mb-4">
                            <div class="flex justify-between items-end mb-2">
                                <span class="text-xs font-bold text-slate-700">Neighbor Trust</span>
                                <span id="trustPercent" class="text-xs font-black text-soft-teal">0%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div id="trustBar" class="progress-fill bg-yellow-400" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="space-y-3" id="relayLogs">
                            <div class="p-3 bg-slate-50 rounded-xl border border-slate-100">
                                <p class="text-[10px] font-bold text-slate-600">Initial Broadcast...</p>
                                <p class="text-[8px] text-gray-400 font-mono">PACKET_ID_772</p>
                            </div>
                        </div>
                    </div>

                    <div id="activeUnit" class="glass-card rounded-[2rem] p-6 bg-gradient-to-br from-white to-teal-50 border-t-4 border-soft-teal hidden">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="w-12 h-12 bg-teal-100 text-soft-teal rounded-xl flex items-center justify-center text-xl">
                                <i id="unitIcon" class="fas fa-ambulance"></i>
                            </div>
                            <div>
                                <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">En-Route</p>
                                <p id="unitName" class="font-bold text-sm">Unit Assigned</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-[10px] border-b border-teal-100 pb-2">
                                <span class="text-gray-500">Distance</span>
                                <span class="font-bold">1.2 KM</span>
                            </div>
                            <div class="flex justify-between text-[10px]">
                                <span class="text-gray-500">ETA</span>
                                <span class="font-bold text-teal-600">~5 MIN</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let pressTimer;
        let isSosActive = false;
        let userPos = { x: 50, y: 50 };
        let trackInterval;
        let trustScore = 0;

        function startPress(e, type) {
            e.preventDefault();
            const ring = document.getElementById(`ring-${type}`);
            let progress = 0;
            pressTimer = setInterval(() => {
                progress += 2.5;
                if (progress <= 100) {
                    ring.style.strokeDashoffset = 283 - (progress / 100) * 283;
                } else {
                    triggerEmergency(type);
                    cancelPress();
                }
            }, 50);
        }

        function cancelPress() {
            clearInterval(pressTimer);
            document.querySelectorAll('.progress-ring circle').forEach(c => c.style.strokeDashoffset = 283);
        }

        function triggerEmergency(type) {
            isSosActive = true;
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('responderSection').classList.remove('hidden');
            document.getElementById('activeSosBar').classList.add('show');
            
            const icons = { Medical: 'fa-ambulance', Fire: 'fa-truck-field', Rescue: 'fa-person-falling-burst', Miscellaneous: 'fa-handshake-angle' };
            document.getElementById('unitIcon').className = `fas ${icons[type]}`;
            document.getElementById('unitName').innerText = `${type} Response Team`;

            startLiveTracking();
            startVerificationSim();
        }

        function addRelayLog(msg, code) {
            const logs = document.getElementById('relayLogs');
            const item = document.createElement('div');
            item.className = 'p-3 bg-slate-50 rounded-xl border border-slate-100 fade-in';
            item.innerHTML = `<p class="text-[10px] font-bold text-slate-600">${msg}</p><p class="text-[8px] text-gray-400 font-mono">${code}</p>`;
            logs.prepend(item);
        }

        function startVerificationSim() {
            let step = 0;
            const steps = [
                { msg: "Pinging nearby nodes...", code: "MESH_SCAN_01", trust: 15 },
                { msg: "Vouch received from Peer-09", code: "AUTH_P2P_VOUCH", trust: 40 },
                { msg: "High-confidence consensus reached", code: "CONSENSUS_70_MET", trust: 75 },
                { msg: "Relaying to Emergency Hub Alpha", code: "RELAY_UPSTREAM", trust: 100 }
            ];

            const sim = setInterval(() => {
                if(step < steps.length) {
                    const s = steps[step];
                    addRelayLog(s.msg, s.code);
                    trustScore = s.trust;
                    document.getElementById('trustBar').style.width = trustScore + '%';
                    document.getElementById('trustPercent').innerText = trustScore + '%';
                    
                    if(trustScore >= 75) {
                        document.getElementById('trustIndicator').innerText = "Verified: Authentic";
                        document.getElementById('trustIndicator').className = "text-[10px] font-black uppercase px-3 py-1 bg-green-100 text-green-700 rounded-lg";
                        document.getElementById('trustBar').classList.replace('bg-yellow-400', 'bg-green-500');
                        document.getElementById('activeUnit').classList.remove('hidden');
                    }
                    step++;
                } else {
                    clearInterval(sim);
                }
            }, 3000);
        }

        function startLiveTracking() {
            const marker = document.getElementById('userMarker');
            const coordText = document.getElementById('coordDisplay');
            const floatingCoord = document.getElementById('liveCoords');
            const routePath = document.getElementById('routeLine');
            let pathData = `M ${(userPos.x/100)*800} ${(userPos.y/100)*450} `;

            trackInterval = setInterval(() => {
                userPos.x += (Math.random() - 0.5) * 4;
                userPos.y += (Math.random() - 0.5) * 4;
                
                marker.style.left = `${userPos.x}%`;
                marker.style.top = `${userPos.y}%`;

                const lat = (28.6139 + (userPos.y - 50) * 0.001).toFixed(4);
                const lon = (77.2090 + (userPos.x - 50) * 0.001).toFixed(4);
                coordText.innerText = `${lat}, ${lon}`;
                floatingCoord.innerText = `Lat: ${lat}, Lon: ${lon}`;

                const pixelX = (userPos.x / 100) * 800;
                const pixelY = (userPos.y / 100) * 450;
                pathData += `L ${pixelX} ${pixelY} `;
                routePath.setAttribute('d', pathData);
            }, 2000);
        }

        function goToUserSection() {
            document.getElementById('responderSection').classList.add('hidden');
            document.getElementById('userSection').classList.remove('hidden');
            document.getElementById('activeSosBar').classList.add('show');
        }

        function goToResponder() {
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('responderSection').classList.remove('hidden');
            document.getElementById('activeSosBar').classList.remove('show');
        }
    </script>
</body>
</html>